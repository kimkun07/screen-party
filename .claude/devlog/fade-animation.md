# Task: Fade Animation (í˜ì´ë“œì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜)

## ê°œìš”

ì„ ì´ ê·¸ë ¤ì§„ í›„ 2ì´ˆ ìœ ì§€ â†’ 1ì´ˆ ë™ì•ˆ í˜ì´ë“œì•„ì›ƒí•˜ì—¬ ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜

## ëª©í‘œ

- [ ] ì„  ì¢…ë£Œ ì‹œ íƒ€ì´ë¨¸ ì‹œì‘
- [ ] 2ì´ˆ ëŒ€ê¸° í›„ í˜ì´ë“œì•„ì›ƒ ì‹œì‘
- [ ] 1ì´ˆ ë™ì•ˆ alpha ê°’ 1.0 â†’ 0.0ìœ¼ë¡œ ê°ì†Œ
- [ ] ì™„ì „íˆ íˆ¬ëª…í•´ì§€ë©´ ì„  ì‚­ì œ
- [ ] ìœ ë‹› í…ŒìŠ¤íŠ¸ ì‘ì„±

## ìƒì„¸ ìš”êµ¬ì‚¬í•­

### íƒ€ì„ë¼ì¸
```
0s          2s          3s
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 ê·¸ë¦¬ëŠ” ì¤‘    ìœ ì§€       í˜ì´ë“œì•„ì›ƒ
             (alpha=1.0) (alpha: 1.0â†’0.0)
                                 â””â”€ ì‚­ì œ
```

### Line ë°ì´í„° êµ¬ì¡° í™•ì¥
```python
@dataclass
class Line:
    line_id: str
    user_id: str
    color: QColor
    points: List[QPointF]
    is_drawing: bool  # ê·¸ë¦¬ëŠ” ì¤‘ì¸ì§€
    alpha: float  # 0.0 ~ 1.0
    end_time: Optional[datetime]  # ì„ ì´ ì¢…ë£Œëœ ì‹œê°
    fade_start_time: Optional[datetime]  # í˜ì´ë“œ ì‹œì‘ ì‹œê°
```

### ì• ë‹ˆë©”ì´ì…˜ ë¡œì§
```python
class LineAnimator:
    def __init__(self, line: Line):
        self.line = line
        self.hold_duration = 2.0  # ì´ˆ
        self.fade_duration = 1.0  # ì´ˆ

    def update(self, current_time: datetime):
        """í”„ë ˆì„ë§ˆë‹¤ í˜¸ì¶œë˜ì–´ alpha ê°’ ì—…ë°ì´íŠ¸"""
        if not self.line.end_time:
            return  # ì•„ì§ ê·¸ë¦¬ëŠ” ì¤‘

        elapsed = (current_time - self.line.end_time).total_seconds()

        if elapsed < self.hold_duration:
            # ìœ ì§€ ë‹¨ê³„
            self.line.alpha = 1.0
        elif elapsed < self.hold_duration + self.fade_duration:
            # í˜ì´ë“œì•„ì›ƒ ë‹¨ê³„
            fade_progress = (elapsed - self.hold_duration) / self.fade_duration
            self.line.alpha = 1.0 - fade_progress
        else:
            # ì™„ì „íˆ ì‚¬ë¼ì§
            self.line.alpha = 0.0
            return True  # ì‚­ì œ ì‹ í˜¸

        return False
```

### ë Œë”ë§ ì‹œ alpha ì ìš©
```python
def paintEvent(self, event: QPaintEvent):
    painter = QPainter(self)

    for line in self.lines.values():
        color = QColor(line.color)
        color.setAlphaF(line.alpha)  # alpha ì ìš©

        pen = QPen(color, 3)
        painter.setPen(pen)
        # ... ê·¸ë¦¬ê¸°
```

### QTimerë¡œ ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
- 60 FPSë¡œ ì—…ë°ì´íŠ¸ (16msë§ˆë‹¤)
- ëª¨ë“  ì„ ì˜ alpha ê°’ ê°±ì‹ 
- alpha = 0.0ì¸ ì„  ì‚­ì œ

## ê¸°ìˆ  ê²°ì •

### ìœ ì§€ ì‹œê°„: 2ì´ˆ
- ë„ˆë¬´ ì§§ìœ¼ë©´ ë¹ ë¥´ê²Œ ì‚¬ë¼ì ¸ì„œ ì •ë³´ ì†ì‹¤
- ë„ˆë¬´ ê¸¸ë©´ í™”ë©´ì´ ì§€ì €ë¶„í•´ì§
- 2ì´ˆê°€ ì ì ˆí•œ ê· í˜•

### í˜ì´ë“œ ì‹œê°„: 1ì´ˆ
- ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼
- ì‚¬ìš©ìê°€ ì„ ì´ ì‚¬ë¼ì§€ëŠ” ê²ƒì„ ì¸ì§€í•  ìˆ˜ ìˆìŒ

## TODO

- [x] Line ë°ì´í„° êµ¬ì¡° í™•ì¥ (end_time, last_update_time, alpha ì¶”ê°€)
- [x] QTimerë¡œ ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ (16ms, ~60 FPS)
- [x] alpha ê°’ ì ìš©í•˜ì—¬ ë Œë”ë§
- [x] alpha = 0.0ì¸ ì„  ìë™ ì‚­ì œ
- [x] íƒ€ì„ì•„ì›ƒ ë¡œì§ êµ¬í˜„ (10ì´ˆ í›„ ê°•ì œ ì‚­ì œ)
- [x] ì‚­ì œëœ ë¼ì¸ ë¬´ì‹œ ë¡œì§ ì¶”ê°€
- [x] ìœ ë‹› í…ŒìŠ¤íŠ¸ ì‘ì„± (11ê°œ í…ŒìŠ¤íŠ¸)
- [x] í˜ì´ë“œì•„ì›ƒ íŒŒë¼ë¯¸í„°í™” (ìƒì„±ì ì¸ì)

## í´ë¡œë“œ ì½”ë“œ ì¼ê¸°

### 2026-01-11 - í˜ì´ë“œì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜ ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ

**ìƒíƒœ**: ğŸŸ¡ ì¤€ë¹„ì¤‘ â†’ âœ… ì™„ë£Œ

**ì§„í–‰ ë‚´ìš©**:

1. **LineData í™•ì¥** (`client/src/screen_party_client/drawing/line_data.py`)
   - `alpha: float = 1.0` - íˆ¬ëª…ë„ (0.0 ~ 1.0)
   - `end_time: Optional[float] = None` - ë“œë¡œì‰ ì¢…ë£Œ ì‹œê° (time.time())
   - `last_update_time: float` - ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê° (íƒ€ì„ì•„ì›ƒ ê°ì§€ìš©)
   - `add_finalized_segments()`, `update_raw_points()` í˜¸ì¶œ ì‹œ last_update_time ê°±ì‹ 
   - `finalize()` í˜¸ì¶œ ì‹œ end_time ì„¤ì •

2. **DrawingCanvas í˜ì´ë“œì•„ì›ƒ ì‹œìŠ¤í…œ** (`client/src/screen_party_client/drawing/canvas.py`)
   - ìƒì„±ì íŒŒë¼ë¯¸í„° ì¶”ê°€:
     - `fade_hold_duration: float = 2.0` - í˜ì´ë“œ ì „ ìœ ì§€ ì‹œê°„
     - `fade_duration: float = 1.0` - í˜ì´ë“œì•„ì›ƒ ì‹œê°„
     - `timeout_duration: float = 10.0` - ê°•ì œ ì‚­ì œ íƒ€ì„ì•„ì›ƒ
   - `deleted_line_ids: Set[str]` - ì‚­ì œëœ ë¼ì¸ ì¶”ì 
   - `animation_timer: QTimer` - 60fps (16ms) ì• ë‹ˆë©”ì´ì…˜ íƒ€ì´ë¨¸
   - `_update_animations()` ë©”ì„œë“œ:
     - ëª¨ë“  ë¼ì¸ì˜ ì•ŒíŒŒê°’ ê³„ì‚°
     - íƒ€ì„ì•„ì›ƒ ì²´í¬ (ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ë¡œë¶€í„° 10ì´ˆ)
     - í˜ì´ë“œì•„ì›ƒ ë‹¨ê³„ ì²˜ë¦¬ (hold â†’ fade â†’ delete)

3. **í˜ì´ë“œì•„ì›ƒ ë¡œì§**
   ```
   0s          2s          3s
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    ê·¸ë¦¬ëŠ” ì¤‘    ìœ ì§€       í˜ì´ë“œì•„ì›ƒ
                (alpha=1.0) (alpha: 1.0â†’0.0)
                                    â””â”€ ì‚­ì œ
   ```
   - drawing_end í›„ 2ì´ˆ ìœ ì§€ (alpha = 1.0)
   - 1ì´ˆì— ê±¸ì³ í˜ì´ë“œì•„ì›ƒ (alpha: 1.0 â†’ 0.0)
   - ì™„ë£Œ í›„ ì‚­ì œ (deleted_line_idsì— ì¶”ê°€)

4. **íƒ€ì„ì•„ì›ƒ ë¡œì§**
   - ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ë¡œë¶€í„° 10ì´ˆ ê²½ê³¼ ì‹œ ê°•ì œ ì‚­ì œ
   - í˜ì´ë“œ ì—†ì´ ì¦‰ì‹œ ì‚­ì œ
   - deleted_line_idsì— ì¶”ê°€

5. **ì‚­ì œëœ ë¼ì¸ ë¬´ì‹œ**
   - `handle_drawing_start()`, `handle_drawing_update()`, `handle_drawing_end()`ì—ì„œ ì‚­ì œëœ ë¼ì¸ ë¬´ì‹œ
   - íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì‚­ì œëœ ë¼ì¸ì€ ì´í›„ ì´ë²¤íŠ¸ê°€ ì™€ë„ ë¬´ì‹œë¨

6. **ë Œë”ë§ ì‹œ ì•ŒíŒŒê°’ ì ìš©**
   - `paintEvent()`ì—ì„œ QColorì— ì•ŒíŒŒê°’ ì„¤ì •
   - `color.setAlphaF(line_data.alpha)`

7. **ìœ ë‹› í…ŒìŠ¤íŠ¸** (`client/tests/test_drawing_canvas.py`)
   - 11ê°œ í˜ì´ë“œì•„ì›ƒ í…ŒìŠ¤íŠ¸ ì¶”ê°€:
     - íŒŒë¼ë¯¸í„° ì´ˆê¸°í™”
     - LineData í•„ë“œ í™•ì¸
     - drawing_end ì‹œ end_time ì„¤ì •
     - í˜ì´ë“œ ìœ ì§€ ë‹¨ê³„
     - í˜ì´ë“œì•„ì›ƒ ë‹¨ê³„
     - í˜ì´ë“œ ì™„ë£Œ í›„ ì‚­ì œ
     - íƒ€ì„ì•„ì›ƒ ê°•ì œ ì‚­ì œ
     - ì‚­ì œëœ ë¼ì¸ ë¬´ì‹œ
     - last_update_time ê°±ì‹ 
     - ì•ŒíŒŒê°’ ë Œë”ë§

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- âœ… **82ê°œ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼** (ê¸°ì¡´ 71ê°œ + í˜ì´ë“œì•„ì›ƒ 11ê°œ)
- âœ… í˜ì´ë“œì•„ì›ƒ í…ŒìŠ¤íŠ¸ 11/11 í†µê³¼
- âœ… ê¸°ì¡´ ê¸°ëŠ¥ ì˜í–¥ ì—†ìŒ

**ì£¼ìš” ê¸°ìˆ  ê²°ì •**:
- **LineAnimator í´ë˜ìŠ¤ ë³„ë„ ë¶„ë¦¬ ì•ˆ í•¨**: DrawingCanvasì— í†µí•©í•˜ì—¬ ë‹¨ìˆœí™”
- **time.time() ì‚¬ìš©**: datetimeë³´ë‹¤ ê°€ë²¼ìš´ íƒ€ì„ìŠ¤íƒ¬í”„
- **60fps íƒ€ì´ë¨¸**: ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ 16ms ê°„ê²©
- **ì‚­ì œëœ ë¼ì¸ ì¶”ì **: íƒ€ì„ì•„ì›ƒ í›„ ì´ë²¤íŠ¸ ë¬´ì‹œë¥¼ ìœ„í•´ Set[str] ì‚¬ìš©

**ì™„ë£Œ ìƒíƒœ**:
- âœ… **P2 fade-animation Task ì™„ì „íˆ ì™„ë£Œ**
- âœ… ëª¨ë“  ìš”êµ¬ì‚¬í•­ êµ¬í˜„ (í˜ì´ë“œì•„ì›ƒ, íƒ€ì„ì•„ì›ƒ, íŒŒë¼ë¯¸í„°í™”)
- âœ… 11ê°œ ìœ ë‹› í…ŒìŠ¤íŠ¸ ì‘ì„± ë° í†µê³¼

**ë‹¤ìŒ ìš°ì„ ìˆœìœ„**:
- P3: persistence-mode (ì¥ì‹œê°„ ê·¸ë¦¼ ëª¨ë“œ)
- P3: color-system (ìƒ‰ìƒ ì„¤ì • ì‹œìŠ¤í…œ)
- P3: window-sync (ì°½ ê´€ë¦¬ ë™ê¸°í™”)

---

> ë‹¤ìŒ í´ë¡œë“œ ì½”ë“œì—ê²Œ:
> - í˜ì´ë“œì•„ì›ƒ ì‹œìŠ¤í…œì€ ì™„ì „íˆ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©°, íŒŒë¼ë¯¸í„°ë¡œ ì‰½ê²Œ ì¡°ì ˆ ê°€ëŠ¥í•©ë‹ˆë‹¤
> - fade_hold_duration, fade_duration, timeout_duration íŒŒë¼ë¯¸í„°ë¥¼ ìˆ˜ì •í•˜ì—¬ ë™ì‘ ë³€ê²½ ê°€ëŠ¥
> - ì‚­ì œëœ ë¼ì¸ì€ deleted_line_ids Setì— ì¶”ì ë˜ë¯€ë¡œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê³ ë ¤ í•„ìš” (í•„ìš”ì‹œ ì£¼ê¸°ì  ì •ë¦¬)
> - ì• ë‹ˆë©”ì´ì…˜ íƒ€ì´ë¨¸ëŠ” í•­ìƒ ì‹¤í–‰ë˜ë¯€ë¡œ ì„±ëŠ¥ ì˜í–¥ ìµœì†Œí™”ë¥¼ ìœ„í•´ ìµœì í™”ë¨
